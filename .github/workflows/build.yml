steps:
  env:
    IMAGE_NAME: jlink-test-image
    TAGS: v1 ${{ github.sha }}

  name: Checkout
  uses: actions/checkout@v2

  # Setup S2i and Build container image
  - name: Setup and Build Spring
    id: build_image_spring
    uses: redhat-actions/s2i-build@v2
    with:
      # TODO: Set up job for each quickstart we're building
      # TODO: Does this respect the .s2i in each one?
      path_context: 'spring-boot-sample-simple'
      # TODO: Need Jmods image
      builder_image: 'registry.access.redhat.com/ubi8/ubi-minimal:latest'
      image: ${{ env.IMAGE_NAME }}
      tags: ${{ env.TAGS }}

  # Push Image to Quay registry
  - name: Push To Quay Action
    uses: redhat-actions/push-to-registry@v2
    with:
      image: ${{ steps.build_image_spring.outputs.image }}
      tags: ${{ steps.build_image_spring.outputs.tags }}
      registry: quay.io/jmatsuok/jlink-tests
      username: ${{ secrets.QUAY_USERNAME }}
      password: ${{ secrets.QUAY_PASSWORD }}
